<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>U.S. Military Presence in East Asia</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.8.0/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.8.0/mapbox-gl.js"></script>
    <link rel="stylesheet" href="https://use.typekit.net/tiz6shb.css">
    <link rel="stylesheet" href="style.css">

    <!-- Google Tag Manager -->

    <script>
        (function (w, d, s, l, i) {
            w[l] = w[l] || []; w[l].push({
                'gtm.start':

                    new Date().getTime(), event: 'gtm.js'
            }); var f = d.getElementsByTagName(s)[0],

                j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =

                    'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);

        })(window, document, 'script', 'dataLayer', 'GTM-TD5NKJJ');
    </script>

<body>
    <div id="map"></div>
    <div id="slideout-panel">
        <button id="close-panel">&times;</button>
        <div id="panel-content">Click on a point to see details</div>
    </div>
    <div class="legend">
        <div class="legend-header">LEGEND</div>

        <div class="legend-item">
            <span class="legend-circle" style="background:#921a1c;"></span>
            ECDA sites
        </div>

        <div class="legend-item">
            <span class="legend-circle" style="background:#fff;"></span>
            Regional Unified Commands of the Filipino military
        </div>

        <div class="legend-item">
            <span class="legend-circle" style="background:none;"></span>
            Territorial Seas
        </div>
        <div class="flex-container">
            <div id="morebox"><a href="#infobox" id="infoLink" class="info-icon">i</a><span id="more-info-text">More
                    Information</span></div>
        </div>
        <br />
        <hr style="margin-top:0;" />
        <p>Read our full report on the Philippines militarisation efforts <a id="reportlink"
                href="https://www.crisisgroup.org/asia/north-east-asia/china-united-states/347-asia-flux-us-china-and-search-new-equilibrium"
                target="_blank">here</a>.</p>
        <p>Source: Crisis Group</p>
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <p><strong>More Info Goes Here</strong></p>
                <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Corrupti mollitia velit itaque officia sapiente assumenda minima, reprehenderit necessitatibus optio adipisci fugiat eos quaerat perferendis quo quod dignissimos pariatur. Eligendi, cupiditate.</p>
                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Magni magnam voluptatum ipsam facilis commodi blanditiis reprehenderit veritatis. Minus numquam molestiae sit, delectus commodi, maxime, perspiciatis in ipsam dolores expedita ut.</p>
            </div>
        </div>
    </div>
    <script>

        document.getElementById("infoLink").addEventListener('click', function (event) {
            event.preventDefault();
            var modal = document.getElementById("myModal");
            modal.classList.add('show');
        });

        document.getElementsByClassName("close")[0].addEventListener('click', function () {
            var modal = document.getElementById("myModal");
            modal.classList.remove('show');
        });

        window.addEventListener('click', function (event) {
            var modal = document.getElementById("myModal");
            if (event.target == modal) {
                modal.classList.remove('show');
            }
        });

        function scroolZoomEnable() {
            const width = window.innerWidth;
            if (width < 1024) {
                return false; // Disable scrollwheel on smaller devices
            } else {
                return true; // Enable it
            }
        }

        mapboxgl.accessToken = 'pk.eyJ1IjoiZGFsdG9ud2IiLCJhIjoiOWdSSXFQSSJ9.HZyjh4g3TAAOAncwelv9Vw';

        const bounds = [
            [75.0, -11.0],  // Further west, into the central Indian Ocean
            [165.0, 35.0]   // Further east, into the Pacific near Micronesia
        ];

        const map = new mapboxgl.Map({
            container: 'map', // The HTML container ID
            style: 'mapbox://styles/daltonwb/cmdq1qrza00kd01s23te5598n',
            center: [123.43068, 19.19328],
            zoom: 3,
            pitchWithRotate: false,
            dragRotate: false,
            maxZoom: 12,
            minZoom: 2.5,
            maxBounds: bounds,
            attributionControl: false,
            dragPan: {
                linearity: 0.3,   // makes panning feel a little more elastic
                maxSpeed: 1400,
                deceleration: 2500,
            }
        });

        // Add navigation controls
        map.addControl(
            new mapboxgl.NavigationControl({ showCompass: false }),
            'top-left'
        );

        // Load map and add Tileset points
        map.on('load', () => {

    map.addSource('cmd-points', {
        type: 'vector',
        url: 'mapbox://daltonwb.90ikdv7d'
    });

    map.addSource('ecda-points', {
        type: 'vector',
        url: 'mapbox://daltonwb.am3c9zcd'
    });

    map.addLayer({
        'id': 'points-layer1',
        'type': 'circle',
        'source': 'cmd-points',
        'source-layer': 'Regional_Unified_Commands_of_the_PH_military',
        'paint': {
            'circle-radius': 7,
            'circle-color': '#e5a47f',
            'circle-opacity': .7,
            'circle-stroke-color': '#d15b28',
            'circle-stroke-width': 2,
            'circle-stroke-opacity': .8
        }
    });

    map.addLayer({
        'id': 'points-layer2',
        'type': 'circle',
        'source': 'ecda-points',
        'source-layer': 'ECDA_Sites',
        'paint': {
            'circle-radius': 7,
            'circle-color': '#921a1c',
            'circle-opacity': .7,
            'circle-stroke-color': '#bd3e27',
            'circle-stroke-width': 2,
            'circle-stroke-opacity': .8
        }
    });

    // Interactive layers list
    const interactiveLayers = ['points-layer1', 'points-layer2'];

    // Pointer cursor on hover
    interactiveLayers.forEach(layerId => {
        map.on('mouseenter', layerId, () => {
            map.getCanvas().style.cursor = 'pointer';
        });

        map.on('mouseleave', layerId, () => {
            map.getCanvas().style.cursor = '';
        });

        map.on('click', layerId, (e) => {
            const coordinates = e.features[0].geometry.coordinates.slice();
            const props = e.features[0].properties;
            const name = props.Name || 'Unnamed';
            const type = props.type || 'default';

            const typeClass = type === 'perm' ? 'popup-perm' :
                              type === 'temp' ? 'popup-temp' : 'popup-default';

            const popup = new mapboxgl.Popup({
                closeButton: true,
                closeOnClick: true,
                className: `hover-popup ${typeClass}`
            });

            // Antimeridian fix
            while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
                coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
            }

            // Smooth pan
            map.easeTo({
                center: coordinates,
                zoom: map.getZoom(),
                duration: 250,
                easing: t => t
            });

            popup
                .setLngLat(coordinates)
                .setHTML(`<div class="hover-popup-content">${name}</div>`)
                .addTo(map);
        });
    });

    map.addControl(new mapboxgl.AttributionControl({
        customAttribution: 'International Crisis Group | Map by <a href="https://www.linkedin.com/in/pkfranz" target="_blank">Paul Franz</a> and <a href="https://www.linkedin.com/in/claireboccongibod/" target="_blank">Claire Boccon-Gibod</a>'
    }));
});


    </script>
</body>

</html>