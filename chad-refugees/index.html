<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Chad Map</title>
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.2.0/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.2.0/mapbox-gl.js"></script>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://use.typekit.net/nqh8ygh.css">
    <script>
        (function (w, d, s, l, i) {
            w[l] = w[l] || []; w[l].push({
                'gtm.start':

                    new Date().getTime(), event: 'gtm.js'
            }); var f = d.getElementsByTagName(s)[0],

                j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =

                    'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);

        })(window, document, 'script', 'dataLayer', 'GTM-TD5NKJJ');
    </script>
</head>

<body>
    <div class="slider-container">
        <h1>Refugee Flows in Chad</h1>
        <input type="range" id="timeSlider" min="0" max="17" value="0" step="1">
        <div id="dateDisplay">Date: 1/12/2024</div>
    </div>
    <div id="map"></div>

    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoiZGFsdG9ud2IiLCJhIjoiOWdSSXFQSSJ9.HZyjh4g3TAAOAncwelv9Vw';

        const map = new mapboxgl.Map({
            container: 'map',
            projection: 'globe',
            style: 'mapbox://styles/daltonwb/cm2lny79i00bg01qrftzkhdgi',
            center: [18.732207, 15.454166], 
            zoom: 5
        });

        const dates = [
            "1/12/2024", "10/12/2023", "11/12/2023", "12/12/2023",
            "2/12/2024", "3/12/2024", "4/12/2024", "4/23/2023",
            "5/12/2023", "5/12/2024", "6/12/2023", "6/12/2024",
            "7/12/2023", "7/12/2024", "8/12/2023", "8/12/2024",
            "9/12/2023", "9/29/2024"
        ];  

        map.on('load', () => {
            // Add the Mapbox Tileset source
            map.addSource('locations', {
                type: 'vector',
                url: 'mapbox://daltonwb.97uq9qgz'  // Replace with your Tileset ID
            });

            // Add a circle layer to display the points
            map.addLayer({
                id: 'locations-layer',
                type: 'circle',
                source: 'locations',
                'source-layer': 'Chad_Sudan_Data_for_Visual_04-2f1uj7', 
                paint: {
                    'circle-radius': [
                        'interpolate', ['linear'], ['get', 'count'],
                        0, 5, 500, 20  // Adjust as needed based on your data
                    ],
                    'circle-color': '#007cbf',
                    'circle-opacity': 0.8
                },
                filter: ['==', ['get', 'date'], dates[0]]  // Initial filter to show first date
            });

            const slider = document.getElementById('timeSlider');
            const dateDisplay = document.getElementById('dateDisplay');

            slider.addEventListener('input', function (e) {
                const selectedDate = dates[e.target.value];

                // Update the filter and date display based on the selected date
                map.setFilter('locations-layer', ['==', ['get', 'date'], selectedDate]);
                dateDisplay.textContent = `Date: ${selectedDate}`;
            });
        });
    </script>
</body>

</html>